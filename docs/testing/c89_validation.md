# C89 Compiler Validation Framework

The C89 Compiler Validation Framework is a test-only utility designed to ensure that the C code generated by the RetroZig compiler is strictly compliant with the ANSI C89 standard and adheres to the specific constraints of MSVC 6.0.

## Overview

As RetroZig targets 1998-era hardware and software, it is critical that the emitted C code does not accidentally use modern C features (C99, C11, etc.). The validation framework provides two layers of verification:

1.  **External Validation (GCC)**: Uses a real C compiler (`gcc -std=c89 -pedantic`) to verify syntactic and semantic correctness of the generated code.
2.  **MSVC 6.0 Simulation (Static Analyzer)**: Performs lightweight static analysis to enforce constraints specific to MSVC 6.0 that might be missed by GCC, such as identifier length limits.

## Core Components

### `C89Validator` Interface
The base class for all validators. It provides a `validate` method that takes a C source string and returns a `ValidationResult`. It also handles wrapping small code snippets into complete translation units with a compatibility header.

### `GCCValidator`
Invokes the system's GCC compiler with strict flags.
- **Flags**: `-std=c89 -pedantic -Wall -Wextra`
- **Portability**: Uses the Platform Abstraction Layer (PAL) to manage temporary files and process execution.
- **Skip Logic**: Automatically skips validation if GCC is not found in the environment.

### `MSVC6StaticAnalyzer`
Enforces legacy constraints including:
- **Identifier Length**: Limit of 31 characters (enforced by MSVC 6.0).
- **No C++ Comments**: Rejects `//` style comments.
- **Modern Keywords**: Rejects C99+ keywords like `inline`, `restrict`, `_Bool`.
- **Types**: Rejects `long long` (prefers `__int64`).

## Usage

### In C++ Tests
Validators are created using factory functions:
```cpp
C89Validator* validator = createGCCValidator();
ValidationResult result = validator->validate("int x = 42;");
if (!result.isValid) {
    // Handle errors
}
delete validator;
```

### Batch Testing
Self-tests for the validation framework are located in **Batch 17**. These tests use known good and bad C samples to verify that the validators themselves are working correctly.

```bash
./test.sh --batch 17
```

## Adding New Validation Checks

To add a new validation check:
1.  **Static Check**: Add logic to `MSVC6StaticAnalyzer` in `tests/c89_validation/msvc6_validator.cpp`.
2.  **Sample**: Add a new "known bad" sample to `tests/c89_validation/known_bad_samples/`.
3.  **Test**: Add a test case to `tests/c89_validation/validation_tests.cpp`.
